/*!
 * Jukebox Object for the jPlayer Plugin
 * http://www.gyrocode.com/projects/jplayer-jukebox
 *
 * Copyright (c) 2014 Gyrocode
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/MIT
 *
 * Author: Michael Ryvkin (http://www.gyrocode.com/projects/jplayer-jukebox)
 * Version: 0.3
 * Date: 5/26/2014
 */
(function(a,b){jPlayerJukebox=function(d){var c=this;this.id="jplayer_jukebox";this.options=a.extend({},this._options,d);this._construct();this.p=a("#"+c.id);this.pl=new jPlayerPlaylist({jPlayer:"#"+c.id,cssSelectorAncestor:"#"+c.id+"_container"},[],this.options);this.trackCur=null;this.typesSupported={mp3:"mp3",m4a:"m4a",oga:"oga,ogg",fla:"fla,flac",wav:"wav",webma:"webma,weba"};this.p.bind(a.jPlayer.event.ready,function(f){c._onReady(f)});this.p.bind(a.jPlayer.event.play,function(f){c._onPlay(f)});this.p.bind(a.jPlayer.event.pause,function(f){c._onPause(f)});this.p.bind(a.jPlayer.event.resize,function(f){c._onResize(f)})};jPlayerJukebox.prototype={_options:{jukeboxOptions:{},playlistOptions:{enableRemoveControls:true},supplied:"mp3",smoothPlayBar:true,keyEnabled:true,audioFullScreen:true,autohide:{minimize:true,restored:false}},_construct:function(){var c=this;var d='<div id="'+c.id+'_container" class="jp-video jp-jukebox jp-pos-float-bl" style="visibility:hidden">   <div class="jp-type-playlist">      <div class="jp-playlist"><ul><li></li></ul></div>      <div class="jp-no-solution">         <span>Update Required</span>         To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.      </div>      <div id="'+c.id+'" class="jp-jplayer"></div>      <div class="jp-gui">         <div class="jp-video-play">            <a href="javascript:;" class="jp-video-play-icon" tabindex="1">play</a>         </div>         <div class="jp-interface">            <div class="jp-progress">               <div class="jp-seek-bar">                  <div class="jp-play-bar"></div>               </div>            </div>            <div class="jp-current-time"></div>            <div class="jp-duration"></div>            <div class="jp-controls-holder">               <ul class="jp-controls">                  <li><a href="javascript:;" class="jp-previous" tabindex="1">previous</a></li>                  <li><a href="javascript:;" class="jp-play" tabindex="1">play</a></li>                  <li><a href="javascript:;" class="jp-pause" tabindex="1">pause</a></li>                  <li><a href="javascript:;" class="jp-next" tabindex="1">next</a></li>                  <li><a href="javascript:;" class="jp-stop" tabindex="1">stop</a></li>                  <li><a href="javascript:;" class="jp-mute" tabindex="1" title="mute">mute</a></li>                  <li><a href="javascript:;" class="jp-unmute" tabindex="1" title="unmute">unmute</a></li>                  <li><a href="javascript:;" class="jp-volume-max" tabindex="1" title="max volume">max volume</a></li>               </ul>               <div class="jp-volume-bar"><div class="jp-volume-bar-value"></div></div>               <ul class="jp-toggles">                  <li><a href="javascript:;" class="jp-playlist-off" tabindex="1" title="hide playlist">hide playlist</a></li>                  <li><a href="javascript:;" class="jp-playlist-on" tabindex="1" title="show playlist">show playlist</a></li>                  <li><a href="javascript:;" class="jp-full-screen" tabindex="1" title="full screen">full screen</a></li>                  <li><a href="javascript:;" class="jp-restore-screen" tabindex="1" title="restore screen">restore screen</a></li>                  <li><a href="javascript:;" class="jp-shuffle" tabindex="1" title="shuffle">shuffle</a></li>                  <li><a href="javascript:;" class="jp-shuffle-off" tabindex="1" title="shuffle off">shuffle off</a></li>                  <li><a href="javascript:;" class="jp-repeat" tabindex="1" title="repeat">repeat</a></li>                  <li><a href="javascript:;" class="jp-repeat-off" tabindex="1" title="repeat off">repeat off</a></li>               </ul>            </div>            <div class="jp-title"><ul><li></li></ul></div>            <div class="jp-visibility-toggle jp-visibility-toggle-on"><div class="jp-visibility-toggle-arrow"></div></div>         </div>      </div>   </div></div>';a("body").append(d)},_getTypeFromExtension:function(f){var m=this;var k=null;try{var j=f;var h=j.indexOf("://");var g=false;if(h!=-1){g=true;j=j.substring(h+3)}h=j.indexOf("?");if(h!=-1){j=j.substring(0,h)}h=j.indexOf("/");var d=false;if(h!=-1){d=true;j=j.substring(h+1)}h=j.lastIndexOf(".");if((!g||d)&&h!=-1){var l=j.substring(h+1,j.length).toLowerCase();for(var c in m.typesSupported){if(m.typesSupported.hasOwnProperty(c)){if(a.inArray(l,m.typesSupported[c].split(","))!=-1){k=c;break}}}if(a.inArray(k,m.options.supplied.split(","))==-1){k=null}}return k}catch(i){return k}},_onReady:function(g){var c=this;var d=a("a");var f=[];a.each(a("a"),function(e,j){var h=a(j);if(h.hasClass("jp-media")){var i=c._getTypeFromExtension(h.attr("href"));if(i){f.push({el:h,type:i,id:f.length,time:0})}}});if(!f.length){a.each(a("a"),function(e,j){var h=a(j);var i=c._getTypeFromExtension(h.attr("href"));if(i){f.push({el:h,type:i,id:f.length,time:0})}})}a.each(f,function(i,e){e.btn=a("<span />",{"class":"jp-page-btn-play",text:"Play"});e.btn.click(function(j){a(this).next(".jp-page-link").click();j.preventDefault()});var h={title:(e.el.attr("title"))?e.el.attr("title"):e.el.attr("href"),artist:(e.el.data("artist"))?e.el.data("artist"):"",track:e};h[e.type]=e.el.attr("href");c.pl.add(h);e.el.before(e.btn);e.el.addClass("jp-page-link");e.el.click(function(m){if(e.btn.hasClass("jp-page-btn-pause")){c.p.jPlayer("pause")}else{var j=0;if(c.trackCur){if(e.id==c.trackCur.id){j=c.trackCur.time}else{c.trackCur.time=0}}var l=-1;if(j===0){a.each(c.pl.playlist,function(n,o){if(o.track.id==e.id){c.pl.select(n);l=n;return false}})}if(l!=-1){c.p.jPlayer("play",j)}else{var k={track:e};k[c.options.supplied]=a(this).attr("href");c.p.jPlayer("setMedia",k);c.p.jPlayer("play",j)}}m.preventDefault()})});a(".jp-playlist-off").hide();a(".jp-playlist").slideUp(0);a(".jp-playlist-on").click(function(h){a(".jp-playlist").slideDown(400,function(){a(".jp-playlist-off").show();a(".jp-playlist-on").hide()})});a(".jp-playlist-off").click(function(h){a(".jp-playlist").slideUp(400,function(){a(".jp-playlist-on").show();a(".jp-playlist-off").hide()})});a("#"+c.id+"_container").css("visibility","visible");c.setVisibility(!c.options.autohide.minimize,0);a(".jp-visibility-toggle").click(function(i){var h=a(this);c.setVisibility((h.hasClass("jp-visibility-toggle-off")),400)})},setVisibility:function(f,e){var c=this;if(f){a("#"+c.id+"_container").finish().animate({left:"0"},e,function(){a(".jp-visibility-toggle").addClass("jp-visibility-toggle-on").removeClass("jp-visibility-toggle-off")})}else{var d=a("#"+c.id+"_container").outerWidth();a("#"+c.id+"_container").finish().animate({left:"-"+(d+1)+"px"},e,function(){a(".jp-visibility-toggle").addClass("jp-visibility-toggle-off").removeClass("jp-visibility-toggle-on")})}},_onPlay:function(d){var c=this;c.trackCur=d.jPlayer.status.media.track;if(a(".jp-page-btn-pause").length){a(".jp-page-btn-pause").removeClass("jp-page-btn-pause").addClass("jp-page-btn-play")}c.trackCur.btn.removeClass("jp-page-btn-play").addClass("jp-page-btn-pause")},_onPause:function(f){var d=this;if(d.trackCur){if(!f.jPlayer.status.ended){d.trackCur.time=f.jPlayer.status.currentTime}else{d.trackCur.time=0}}var c=f.jPlayer.status.media.track;c.btn.removeClass("jp-page-btn-pause").addClass("jp-page-btn-play")},_onResize:function(d){var c=this;if(a(".jp-playlist-on").css("display")!=="none"){if(d.jPlayer.options.fullScreen){a(".jp-playlist").slideDown(0)}else{a(".jp-playlist").slideUp(0)}}}}})(jQuery);