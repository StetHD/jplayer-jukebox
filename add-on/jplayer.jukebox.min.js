/*!
 * Jukebox Object for the jPlayer Plugin
 * http://www.gyrocode.com/projects/jplayer-jukebox
 *
 * Copyright (c) 2014 Gyrocode
 * Licensed under the MIT license.
 * http://www.opensource.org/licenses/MIT
 *
 * Author: Michael Ryvkin (http://www.gyrocode.com/projects/jplayer-jukebox)
 * Version: 0.3
 * Date: 5/26/2014
 */
(function(a,b){jPlayerJukebox=function(d){var c=this;this.id="jplayer_jukebox";this.options=a.extend({},this._options,d);this._construct();this.j=a("#"+c.id+"_container");this.p=a("#"+c.id);this.pl=new jPlayerPlaylist({jPlayer:"#"+c.id,cssSelectorAncestor:"#"+c.id+"_container"},[],this.options);this.trackCur=null;this.typesSupported={mp3:"mp3",m4a:"m4a",oga:"oga,ogg",fla:"fla,flac",wav:"wav",webma:"webma,weba"};this.p.bind(a.jPlayer.event.ready,function(f){c._onReady(f)});this.p.bind(a.jPlayer.event.play,function(f){c._onPlay(f)});this.p.bind(a.jPlayer.event.pause,function(f){c._onPause(f)});this.p.bind(a.jPlayer.event.resize,function(f){c._onResize(f)})};jPlayerJukebox.prototype={_options:{jukeboxOptions:{},playlistOptions:{enableRemoveControls:true},supplied:"mp3",smoothPlayBar:true,keyEnabled:true,audioFullScreen:true,autohide:{minimize:true,restored:false},useStateClassSkin:true},_construct:function(){var c=this;var d='<div id="'+c.id+'_container" class="jp-video jp-jukebox jp-pos-float-bl" style="visibility:hidden" role="application" aria-label="media player"><div class="jp-type-playlist"><div class="jp-playlist"><ul><li></li></ul></div><div id="'+c.id+'" class="jp-jplayer"></div><div class="jp-gui">   <div class="jp-video-play">      <button class="jp-video-play-icon" role="button" tabindex="0">play</button>   </div>   <div class="jp-interface">      <div class="jp-progress">         <div class="jp-seek-bar">            <div class="jp-play-bar"></div>         </div>      </div>      <div class="jp-current-time" role="timer" aria-label="time"></div>      <div class="jp-duration" role="timer" aria-label="duration"></div>      <div class="jp-controls-holder">         <div class="jp-controls">            <button class="jp-previous" role="button" tabindex="0">previous</button>            <button class="jp-play" role="button" tabindex="0">play</button>            <button class="jp-stop" role="button" tabindex="0">stop</button>            <button class="jp-next" role="button" tabindex="0">next</button>         </div>         <div class="jp-volume-controls">            <button class="jp-mute" role="button" tabindex="0">mute</button>            <button class="jp-volume-max" role="button" tabindex="0">max volume</button>            <div class="jp-volume-bar">               <div class="jp-volume-bar-value"></div>            </div>         </div>         <div class="jp-toggles">            <button class="jp-repeat" role="button" tabindex="0">repeat</button>            <button class="jp-shuffle" role="button" tabindex="0">shuffle</button>            <button class="jp-full-screen" role="button" tabindex="0">full screen</button>            <button class="jp-show-playlist" role="button" tabindex="0">playlist</button>         </div>      </div>      <div class="jp-details">         <div class="jp-title" aria-label="title"></div>      </div>      <div class="jp-visibility-toggle jp-visibility-toggle-on"><div class="jp-visibility-toggle-arrow"></div></div>   </div></div><div class="jp-no-solution">   <span>Update Required</span>   To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.</div></div></div>';a("body").append(d)},_getFilenameFromUrl:function(c){var d=c;index=d.indexOf("?");if(index!=-1){d=d.substring(0,index)}index=d.lastIndexOf("/");if(index!=-1){d=d.substring(index+1)}return d},_getTypeFromUrl:function(f){var m=this;var k=null;try{var j=f;var h=j.indexOf("://");var g=false;if(h!=-1){g=true;j=j.substring(h+3)}h=j.indexOf("?");if(h!=-1){j=j.substring(0,h)}h=j.lastIndexOf("/");var d=false;if(h!=-1){d=true;j=j.substring(h+1)}h=j.lastIndexOf(".");if((!g||d)&&h!=-1){var l=j.substring(h+1,j.length).toLowerCase();for(var c in m.typesSupported){if(m.typesSupported.hasOwnProperty(c)){if(a.inArray(l,m.typesSupported[c].split(","))!=-1){k=c;break}}}if(a.inArray(k,m.options.supplied.split(","))==-1){k=null}}return k}catch(i){return k}},_onReady:function(d){var c=this;a(".jp-playlist").slideUp(0);a(".jp-show-playlist").click(function(f){if(c.j.hasClass("jp-state-playlist")){c.j.removeClass("jp-state-playlist");a(".jp-playlist").slideUp(400)}else{c.j.addClass("jp-state-playlist");a(".jp-playlist").slideDown(400)}});a("#"+c.id+"_container").css("visibility","visible");c.setVisibility(!c.options.autohide.minimize,0);a(".jp-visibility-toggle").click(function(g){var f=a(this);c.setVisibility((f.hasClass("jp-visibility-toggle-off")),400)});this.parsePage()},parsePage:function(f){var k=this;var c=a("a").not(".jp-page-link");var h=[];var j=k.pl.playlist.length;var d,m,g;for(d=0;d<c.length;d++){m=a(c[d]);if(m.hasClass("jp-media")){g=k._getTypeFromUrl(m.attr("href"));if(g){h.push({el:m,type:g,id:j+h.length,time:0})}}}if(!h.length){for(d=0;d<c.length;d++){m=a(c[d]);g=k._getTypeFromUrl(m.attr("href"));if(g){h.push({el:m,type:g,id:j+h.length,time:0})}}}for(d=0;d<h.length;d++){track=h[d];track.btn=a("<span />",{"class":"jp-page-btn-play",text:"Play"});track.btn.click(function(i){a(this).next(".jp-page-link").click();i.preventDefault()});var l={title:(track.el.attr("title"))?track.el.attr("title"):k._getFilenameFromUrl(track.el.attr("href")),artist:(track.el.data("artist"))?track.el.data("artist"):"",track:track};l[track.type]=track.el.attr("href");k.pl.add(l);track.el.before(track.btn);track.el.addClass("jp-page-link");track.el.click({track:track},function(s){var n=s.data.track;if(n.btn.hasClass("jp-page-btn-pause")){k.p.jPlayer("pause")}else{var p=0;if(k.trackCur){if(n.id==k.trackCur.id){p=k.trackCur.time}else{k.trackCur.time=0}}var r=-1;var o;if(p===0){for(o=0;o<k.pl.playlist.length;o++){playlistItem=k.pl.playlist[o];if(playlistItem.track.id==n.id){k.pl.select(o);r=o;break}}}if(r!=-1){k.p.jPlayer("play",p)}else{var q={track:n};q[k.options.supplied]=a(this).attr("href");k.p.jPlayer("setMedia",q);k.p.jPlayer("play",p)}}s.preventDefault()})}},setVisibility:function(f,e){var c=this;if(f){a("#"+c.id+"_container").finish().animate({left:"0"},e,function(){a(".jp-visibility-toggle").addClass("jp-visibility-toggle-on").removeClass("jp-visibility-toggle-off")})}else{var d=a("#"+c.id+"_container").outerWidth();a("#"+c.id+"_container").finish().animate({left:"-"+(d+1)+"px"},e,function(){a(".jp-visibility-toggle").addClass("jp-visibility-toggle-off").removeClass("jp-visibility-toggle-on")})}},_onPlay:function(d){var c=this;c.trackCur=d.jPlayer.status.media.track;if(a(".jp-page-btn-pause").length){a(".jp-page-btn-pause").removeClass("jp-page-btn-pause").addClass("jp-page-btn-play")}c.trackCur.btn.removeClass("jp-page-btn-play").addClass("jp-page-btn-pause")},_onPause:function(f){var d=this;if(d.trackCur){if(!f.jPlayer.status.ended){d.trackCur.time=f.jPlayer.status.currentTime}else{d.trackCur.time=0}}var c=f.jPlayer.status.media.track;c.btn.removeClass("jp-page-btn-pause").addClass("jp-page-btn-play")},_onResize:function(d){var c=this;if(a(".jp-playlist-on").css("display")!=="none"){if(d.jPlayer.options.fullScreen){a(".jp-playlist").slideDown(0)}else{a(".jp-playlist").slideUp(0)}}}}})(jQuery);