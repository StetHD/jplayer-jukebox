/*! jPlayer Jukebox add-on 0.6.0 (http://www.gyrocode.com/projects/jplayer-jukebox) ~ (c) Gyrocode.com ~ MIT License */
(function($,undefined){jPlayerJukebox=function(options){var jb=this;var g={"id":"jplayer_jukebox","optionsDefaults":{"jukeboxOptions":{"autoAdvance":true,"cover":false,"position":"float-bl","className":"ui-light ui-gradient"},"playlistOptions":{"enableRemoveControls":true},"supplied":"mp3","smoothPlayBar":true,"keyEnabled":true,"audioFullScreen":false,"autohide":{"minimize":true,"restored":false},"useStateClassSkin":true},"track":null,"typesSupported":{"mp3":"mp3","m4a":"m4a","oga":"oga,ogg","fla":"fla,flac","wav":"wav","webma":"webma,weba","xspf":"xspf"}};g.options=$.extend({},g.optionsDefaults,options);if(typeof g.options["jukeboxOptions"]!=="undefined"){g.options.jukeboxOptions=$.extend({},g.optionsDefaults.jukeboxOptions,g.options.jukeboxOptions);}if(g.options.jukeboxOptions.position!=="float-bl"&&g.options.jukeboxOptions.position!=="fixed-t"&&g.options.jukeboxOptions.position!=="fixed-b"){g.options.jukeboxOptions.position=g.optionsDefaults.jukeboxOptions.position;}_construct();g.$jp=$("#"+g.id);g.$jc=$("#"+g.id+"_container");g.pl=new jPlayerPlaylist({jPlayer:"#"+g.id,cssSelectorAncestor:"#"+g.id+"_container"},[],g.options);g.$jp.on($.jPlayer.event.ready,function(e){_onReady(e);});g.$jp.on($.jPlayer.event.play,function(e){_onPlay(e);});g.$jp.on($.jPlayer.event.pause,function(e){_onPause(e);});g.$jp.on($.jPlayer.event.resize,function(e){_onResize(e);});g.$jp.off($.jPlayer.event.ended);g.$jp.on($.jPlayer.event.ended,function(e){_onEnded(e);});this.add=function(track,playNow){return g.pl.add(track,playNow);};this.remove=function(index){return g.pl.remove(index);};this.select=function(index){return g.pl.select(index);};this.shuffle=function(shuffled,playNow){return g.pl.shuffle(index);};this.next=function(){return g.pl.next();};this.previous=function(){return g.pl.previous();};this.pause=function(){return g.pl.pause();};this.parsePage=function(e){var jb=this;var $anchors_media=$("a.jp-media");var $anchors=($anchors_media.length)?$anchors_media:$("a").not(".jp-page-link");var i,$el,type;for(i=0;i<$anchors.length;i++){$el=$($anchors[i]);type=_getTypeFromUrl($el.attr("href"));if(!type&&$el.attr("type")==="application/xspf+xml"){if($.inArray("xspf",g.options.supplied.split(","))!==-1){type="xspf";}}if(type){if(type==="xspf"){_addPlaylist(type,$el);}else{var track={"el":$el,"type":type,"id":g.pl.playlist.length,"time":0,"btn":$("<span />",{"class":"jp-page-btn-play"}),"url":$el.attr("href"),"title":($el.attr("title"))?$el.attr("title"):_getFilenameFromUrl($el.attr("href")),"artist":($el.data("artist"))?$el.data("artist"):"","album":($el.data("album"))?$el.data("album"):"","image":($el.data("image"))?$el.data("image"):""};_addTrack(track);}}}};this.setVisibility=function(state,speed){var jb=this;if(state){g.$jc.finish().animate({left:"0"},speed,function(){$(this).addClass("jp-visibility-on").removeClass("jp-visibility-off");});}else{var width=g.$jc.outerWidth();g.$jc.finish().animate({left:"-"+(width+1)+"px"},speed,function(){$(this).addClass("jp-visibility-off").removeClass("jp-visibility-on");});}};function _construct(){var html='<div id="'+g.id+'_container" class="jp-jukebox" style="visibility:hidden" role="application" aria-label="media player">'+'<div class="jp-playlist jp-gui-bg"><div class="jp-gui-texture"></div><ul><li></li></ul></div>'+'<div id="'+g.id+'" class="jp-jplayer"></div>'+'<div class="jp-gui jp-gui-bg">'+'   <div class="jp-gui-texture"></div>'+'   <div class="jp-gui-gradient"></div>'+'   <div class="jp-interface">'+'      <div class="jp-progress">'+'         <div class="jp-seek-bar">'+'            <div class="jp-play-bar"></div>'+"         </div>"+"      </div>"+'      <div class="jp-current-time" role="timer" aria-label="time"></div>'+'      <div class="jp-duration" role="timer" aria-label="duration"></div>'+'      <div class="jp-controls-holder">'+'         <div class="jp-controls">'+'            <button class="jp-previous" role="button" tabindex="0" title="Previous track">previous</button>'+'            <button class="jp-play" role="button" tabindex="0" title="Play">play</button>'+'            <button class="jp-stop" role="button" tabindex="0">stop</button>'+'            <button class="jp-next" role="button" tabindex="0" title="Next track">next</button>'+"         </div>"+'         <div class="jp-volume-controls">'+'            <button class="jp-mute" role="button" tabindex="0" title="Mute">mute</button>'+'            <button class="jp-volume-max" role="button" tabindex="0" title="Max volume">max volume</button>'+'            <div class="jp-volume-bar">'+'               <div class="jp-volume-bar-value"></div>'+"            </div>"+"         </div>"+'         <div class="jp-toggles">'+'            <button class="jp-repeat" role="button" tabindex="0" title="Repeat all">repeat</button>'+'            <button class="jp-shuffle" role="button" tabindex="0" title="Shuffle">shuffle</button>'+'            <button class="jp-full-screen" role="button" tabindex="0" title="Full screen">full screen</button>'+'            <button class="jp-show-playlist" role="button" tabindex="0" title="Playlist">playlist</button>'+"         </div>"+"      </div>"+'      <div class="jp-details">'+'         <div class="jp-cover" aria-label="cover art"><div class="jp-cover-default"></div></div>'+'         <div class="jp-title" aria-label="title"></div>'+"      </div>"+'      <div class="jp-app-bar"><a href="http://www.gyrocode.com/projects/jplayer-jukebox" target="_blank">jPlayer Jukebox</a></div>'+'      <div class="jp-visibility-control jp-gui-bg"><div class="jp-gui-texture"></div><div class="jp-gui-gradient"></div><button class="jp-visibility-toggle" role="button" tabindex="0">&times;</button></div>'+"   </div>"+"</div>"+'<div class="jp-no-solution">'+"   <span>Update Required</span>"+'   To play the media you will need to either update your browser to a recent version or update your <a href="http://get.adobe.com/flashplayer/" target="_blank">Flash plugin</a>.'+"</div>"+"</div>";$("body").append(html);}function _getFilenameFromUrl(url){var fn=url;index=fn.indexOf("?");if(index!=-1){fn=fn.substring(0,index);}index=fn.lastIndexOf("/");if(index!=-1){fn=fn.substring(index+1);}return fn;}function _getTypeFromUrl(url){var type=null;try{var str=url;var index=str.indexOf("://");var is_proto_avail=false;if(index!=-1){is_proto_avail=true;str=str.substring(index+3);}index=str.indexOf("?");if(index!=-1){str=str.substring(0,index);}index=str.lastIndexOf("/");var is_file_avail=false;if(index!=-1){is_file_avail=true;str=str.substring(index+1);}index=str.lastIndexOf(".");if((!is_proto_avail||is_file_avail)&&index!=-1){var extension=str.substring(index+1,str.length).toLowerCase();for(var typeSupported in g.typesSupported){if(g.typesSupported.hasOwnProperty(typeSupported)){if($.inArray(extension,g.typesSupported[typeSupported].split(","))!=-1){type=typeSupported;break;}}}if($.inArray(type,g.options.supplied.split(","))==-1){type=null;}}return type;}catch(e){return type;}}function _onReady(e){$(".jp-playlist").slideUp(0);$(".jp-show-playlist").on("click",function(e){if(g.$jc.hasClass("jp-state-playlist")){g.$jc.removeClass("jp-state-playlist");$(".jp-playlist").slideUp(400);}else{g.$jc.addClass("jp-state-playlist");$(".jp-playlist").slideDown(400);}});g.$jc.css("visibility","visible").addClass("opt-pos-"+g.options.jukeboxOptions.position).addClass("opt-cover-"+((g.options.jukeboxOptions.cover)?1:0)).addClass(g.options.jukeboxOptions.className);if(g.options.jukeboxOptions.position==="float-bl"){jb.setVisibility(!g.options.autohide.minimize,0);$(".jp-visibility-toggle").on("click",function(e){var $btn=$(this);jb.setVisibility(g.$jc.hasClass("jp-visibility-off"),400);});}$(".jp-details").show();jb.parsePage();if(g.options.jukeboxOptions.hasOwnProperty("onInitComplete")&&typeof g.options.jukeboxOptions.onInitComplete==="function"){g.options.jukeboxOptions.onInitComplete(jb);}}function _addPlaylist(type,$el){if(type==="xspf"){$.get($el.attr("href"),{},function(xml){$("track",xml).each(function(index,value){var track={"el":$el,"type":type,"id":g.pl.playlist.length,"time":0,"btn":$("<span />",{"class":"jp-page-btn-play"}),"url":$("location",this).text(),"title":$("title",this).text(),"artist":$("creator",this).text(),"album":$("album",this).text(),"image":$("image",this).text()};track["type"]=_getTypeFromUrl(track["url"]);if(track["type"]){_addTrack(track);}});},"xml");}}function _addTrack(track){if(!track.el.hasClass("jp-page-link")){track.btn.on("click",null,{"track":track},function(e){_onClick(e);});track.el.before(track.btn);track.el.addClass("jp-page-link");track.el.on("click",null,{"track":track},function(e){_onClick(e);});}var playlistEntry={"title":track.title,"artist":track.artist,"poster":track.image,"track":track};playlistEntry[track.type]=track.url;g.pl.add(playlistEntry);}function _onClick(e){var track=e.data.track;if(track.btn.hasClass("jp-page-btn-pause")){g.$jp.jPlayer("pause");}else{var isTrackFound=false;var playTime=0;if(g.track){if(track.id==g.track.id){playTime=g.track.time;isTrackFound=true;}else{g.track.time=0;}}var i;if(playTime===0){for(i=0;i<g.pl.playlist.length;i++){playlistItem=g.pl.playlist[i];if(playlistItem.track.id==track.id){g.pl.select(i);isTrackFound=true;break;}}}if(isTrackFound){g.$jp.jPlayer("play",playTime);}else{var media={track:track};media[track.type]=track.el.attr("href");g.$jp.jPlayer("setMedia",media);g.$jp.jPlayer("play",playTime);}}e.preventDefault();}function _onPlay(e){g.track=e.jPlayer.status.media.track;if($(".jp-page-btn-pause").length){$(".jp-page-btn-pause").removeClass("jp-page-btn-pause").addClass("jp-page-btn-play");}if(g.options.jukeboxOptions.cover){if(g.track.image!==""){$(".jp-cover").html($("<img>",{"src":g.track.image}).wrap("<div></div>").parent().html());}else{$(".jp-cover").html('<div class="jp-cover-default"></div>');}}g.track.btn.removeClass("jp-page-btn-play").addClass("jp-page-btn-pause");}function _onPause(e){if(g.track){if(!e.jPlayer.status.ended){g.track.time=e.jPlayer.status.currentTime;}else{g.track.time=0;}}var track=e.jPlayer.status.media.track;track.btn.removeClass("jp-page-btn-pause").addClass("jp-page-btn-play");}function _onResize(e){if($(".jp-playlist-on").css("display")!=="none"){if(e.jPlayer.options.fullScreen){$(".jp-playlist").slideDown(0);}else{$(".jp-playlist").slideUp(0);}}}function _onEnded(e){if(g.options.jukeboxOptions.autoAdvance){jb.next();}}};})(jQuery);